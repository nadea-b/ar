<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>The Secret Garden's Lost Butterflies</title>
  <script src="https://cdn.jsdelivr.net/gh/aframevr/aframe@1c2407b26c61958baa93967b5412487cd94b290b/dist/aframe-master.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
  
  <style>
    .arjs-loader {
      height: 100%;
      width: 100%;
      position: absolute;
      top: 0;
      left: 0;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      z-index: 9999;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }

    .arjs-loader div {
      text-align: center;
      font-size: 1.25em;
      color: white;
      font-family: 'Arial', sans-serif;
      margin: 10px;
    }

    .progress-bar {
      width: 80%;
      max-width: 300px;
      height: 20px;
      background: rgba(255,255,255,0.3);
      border-radius: 10px;
      margin-top: 20px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #f093fb 0%, #f5576c 100%);
      width: 0%;
      transition: width 0.5s ease;
    }

    .hud-overlay {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1000;
      background: rgba(0,0,0,0.7);
      color: white;
      padding: 15px 30px;
      border-radius: 20px;
      font-family: 'Arial', sans-serif;
      text-align: center;
      backdrop-filter: blur(10px);
      display: none;
    }

    .hud-overlay.show {
      display: block;
      animation: slideDown 0.5s ease;
    }

    @keyframes slideDown {
      from { top: -100px; opacity: 0; }
      to { top: 20px; opacity: 1; }
    }

    .locked-message {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(255,0,0,0.8);
      color: white;
      padding: 30px;
      border-radius: 15px;
      font-size: 1.2em;
      text-align: center;
      z-index: 1001;
      display: none;
      font-family: 'Arial', sans-serif;
    }

    .celebration {
      position: fixed;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 999;
    }
  </style>
</head>

<body style="margin: 0px; overflow: hidden;">
  <!-- Loader -->
  <div class="arjs-loader">
    <div>ðŸ¦‹ The Secret Garden's Lost Butterflies ðŸ¦‹</div>
    <div>Loading magical experience...</div>
    <div class="progress-bar">
      <div class="progress-fill" id="progressFill"></div>
    </div>
  </div>

  <!-- HUD Overlay for Progress -->
  <div class="hud-overlay" id="hudOverlay">
    <div id="hudText">Find the first flower...</div>
    <div style="margin-top: 10px; font-size: 0.9em;" id="hudProgress">Progress: 0/3</div>
  </div>

  <!-- Locked Message -->
  <div class="locked-message" id="lockedMessage">
    ðŸ”’ This flower is locked!<br>
    <span style="font-size: 0.8em; margin-top: 10px; display: block;">Find the previous flowers first</span>
  </div>

  <!-- A-Frame Scene -->
  <a-scene
    vr-mode-ui="enabled: false;"
    renderer="logarithmicDepthBuffer: true; precision: high;"
    embedded
    arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;"
    gesture-detector
  >
    
    <!-- ============================================ -->
    <!-- FLOWER 1: Pink Flowers with Black Butterfly -->
    <!-- ============================================ -->
    <a-nft
      type="nft"
      url="flower1"
      smooth="true"
      smoothCount="10"
      smoothTolerance=".01"
      smoothThreshold="5"
      id="flower1-marker"
    >
      <!-- Fixed container for stability -->
      <a-entity id="flower1-content" position="0 0 0">
        
        <!-- Animated Butterfly -->
        <a-entity 
          id="butterfly1"
          class="clickable"
          position="0 0.8 0"
          animation="property: position; to: 0.3 1.2 0; dur: 3000; easing: easeInOutSine; loop: true; dir: alternate"
          animation__rotate="property: rotation; to: 0 360 0; dur: 10000; easing: linear; loop: true"
        >
          <!-- Butterfly body -->
          <a-cylinder color="#2C3E50" height="0.2" radius="0.03" position="0 0 0"></a-cylinder>
          <!-- Left wing -->
          <a-triangle color="#FF1493" scale="0.25 0.25 0.25" position="-0.15 0 0" rotation="0 0 30"></a-triangle>
          <a-circle color="#C71585" radius="0.1" position="-0.2 0.05 0.01"></a-circle>
          <!-- Right wing -->
          <a-triangle color="#FF1493" scale="0.25 0.25 0.25" position="0.15 0 0" rotation="0 0 -30"></a-triangle>
          <a-circle color="#C71585" radius="0.1" position="0.2 0.05 0.01"></a-circle>
          <!-- Sparkles -->
          <a-sphere color="#FFD700" radius="0.02" position="-0.1 0.1 0.02" 
            animation="property: scale; to: 1.5 1.5 1.5; dur: 1000; easing: easeInOutSine; loop: true; dir: alternate"></a-sphere>
        </a-entity>

        <!-- Locked Treasure Box -->
        <a-entity id="box1" class="clickable" position="-0.5 0.3 0" scale="0.15 0.15 0.15">
          <a-box color="#8B4513" depth="1" height="0.7" width="1"></a-box>
          <a-box color="#DAA520" depth="1.05" height="0.1" width="1.05" position="0 0.3 0"></a-box>
          <!-- Lock -->
          <a-torus color="#FFD700" radius="0.15" radius-tubular="0.03" position="0 0 0.51"></a-torus>
          <a-cylinder color="#FFD700" height="0.2" radius="0.03" position="0 -0.1 0.51"></a-cylinder>
        </a-entity>

        <!-- Hidden Riddle (appears when butterfly clicked) -->
        <a-entity id="riddle1" visible="false" position="0 0 0">
          <a-plane color="#FFF5F5" width="2" height="1" opacity="0.95"></a-plane>
          <a-text 
            value="I am the first of three,\nIn gardens where I'm free.\nFind my friend in golden light,\nWho follows sun from left to right." 
            color="#2C3E50"
            align="center"
            width="1.8"
            position="0 0 0.01"
            wrap-count="30"
          ></a-text>
          <a-text 
            value="ðŸŒ» Seek the YELLOW flowers! ðŸŒ»" 
            color="#F39C12"
            align="center"
            width="1.5"
            position="0 -0.35 0.01"
            scale="0.7 0.7 0.7"
          ></a-text>
        </a-entity>

        <!-- Progress Indicator -->
        <a-text 
          id="progress1"
          value="1/3 Found!" 
          color="#27AE60"
          align="center"
          width="1.5"
          position="0.5 0.8 0"
          scale="0.4 0.4 0.4"
          visible="false"
        ></a-text>

      </a-entity>
    </a-nft>

    <!-- ============================================ -->
    <!-- FLOWER 2: Yellow Flowers with Green Butterfly -->
    <!-- ============================================ -->
    <a-nft
      type="nft"
      url="flower2"
      smooth="true"
      smoothCount="10"
      smoothTolerance=".01"
      smoothThreshold="5"
      id="flower2-marker"
    >
      <a-entity id="flower2-content" position="0 0 0">
        
        <!-- Main Golden Butterfly -->
        <a-entity 
          id="butterfly2"
          class="clickable"
          position="0 0.8 0"
          animation="property: position; to: 0 1.3 0; dur: 2500; easing: easeInOutSine; loop: true; dir: alternate"
        >
          <!-- Body -->
          <a-cylinder color="#FF8C00" height="0.25" radius="0.04"></a-cylinder>
          <!-- Wings -->
          <a-triangle color="#FFD700" scale="0.35 0.35 0.35" position="-0.2 0 0" rotation="0 0 20"></a-triangle>
          <a-triangle color="#FFD700" scale="0.35 0.35 0.35" position="0.2 0 0" rotation="0 0 -20"></a-triangle>
          <a-circle color="#FFA500" radius="0.08" position="-0.15 0.1 0.01"></a-circle>
          <a-circle color="#FFA500" radius="0.08" position="0.15 0.1 0.01"></a-circle>
          <!-- Sun rays -->
          <a-ring color="#FFFF00" radius-inner="0.2" radius-outer="0.25" position="0 0 -0.02"
            animation="property: rotation; to: 0 0 360; dur: 5000; easing: linear; loop: true"></a-ring>
        </a-entity>

        <!-- Small butterflies (appear when main butterfly clicked) -->
        <a-entity id="small-butterflies" visible="false">
          <a-entity position="-0.4 0.6 0" animation="property: position; to: -0.6 1 0; dur: 2000; loop: true; dir: alternate">
            <a-triangle color="#87CEEB" scale="0.15 0.15 0.15"></a-triangle>
          </a-entity>
          <a-entity position="0.4 0.6 0" animation="property: position; to: 0.6 1 0; dur: 2000; loop: true; dir: alternate">
            <a-triangle color="#98FB98" scale="0.15 0.15 0.15"></a-triangle>
          </a-entity>
          <a-entity position="0 1 0" animation="property: position; to: 0 1.3 0; dur: 1800; loop: true; dir: alternate">
            <a-triangle color="#DDA0DD" scale="0.15 0.15 0.15"></a-triangle>
          </a-entity>
        </a-entity>

        <!-- Treasure Box Half Open -->
        <a-entity id="box2" class="clickable" position="-0.5 0.3 0" scale="0.15 0.15 0.15">
          <a-box color="#8B4513" depth="1" height="0.7" width="1"></a-box>
          <!-- Lid slightly open -->
          <a-box color="#DAA520" depth="1.05" height="0.1" width="1.05" position="0 0.4 0" rotation="-30 0 0"></a-box>
          <!-- Glow inside -->
          <a-sphere color="#FFD700" radius="0.3" position="0 0.2 0" opacity="0.6"
            animation="property: opacity; to: 0.9; dur: 1000; loop: true; dir: alternate"></a-sphere>
        </a-entity>

        <!-- Floating Petals (clickable) -->
        <a-entity id="petals" visible="true">
          <a-circle id="petal1" class="clickable" color="#FFEB3B" radius="0.1" position="0.3 0.5 0"
            animation="property: position; to: 0.3 0.7 0; dur: 2000; loop: true; dir: alternate"></a-circle>
          <a-circle id="petal2" class="clickable" color="#FDD835" radius="0.08" position="-0.3 0.6 0"
            animation="property: position; to: -0.3 0.8 0; dur: 1800; loop: true; dir: alternate"></a-circle>
        </a-entity>

        <!-- Riddle -->
        <a-entity id="riddle2" visible="false" position="0 0 0">
          <a-plane color="#FFFEF0" width="2" height="1" opacity="0.95"></a-plane>
          <a-text 
            value="Well done, seeker of light!\nNow find beauty in the night.\nPurple dreams and calming scent,\nThe final key shall be sent." 
            color="#2C3E50"
            align="center"
            width="1.8"
            position="0 0 0.01"
            wrap-count="28"
          ></a-text>
          <a-text 
            value="ðŸª· Seek the LOTUS flower! ðŸª·" 
            color="#9B59B6"
            align="center"
            width="1.5"
            position="0 -0.35 0.01"
            scale="0.7 0.7 0.7"
          ></a-text>
        </a-entity>

        <a-text 
          id="progress2"
          value="2/3 Found!" 
          color="#F39C12"
          align="center"
          width="1.5"
          position="0.5 0.8 0"
          scale="0.4 0.4 0.4"
          visible="false"
        ></a-text>

      </a-entity>
    </a-nft>

    <!-- ============================================ -->
    <!-- FLOWER 3: Pink Lotus with Dragonfly -->
    <!-- ============================================ -->
    <a-nft
      type="nft"
      url="flower3"
      smooth="true"
      smoothCount="10"
      smoothTolerance=".01"
      smoothThreshold="5"
      id="flower3-marker"
    >
      <a-entity id="flower3-content" position="0 0 0">
        
        <!-- Three Butterflies United -->
        <a-entity id="united-butterflies" position="0 1 0"
          animation="property: rotation; to: 0 360 0; dur: 8000; easing: linear; loop: true">
          <!-- Pink butterfly -->
          <a-entity position="0.25 0 0">
            <a-triangle color="#FF1493" scale="0.2 0.2 0.2" rotation="0 0 30"></a-triangle>
            <a-circle color="#FFB6C1" radius="0.06" position="0 0.05 0.01"></a-circle>
          </a-entity>
          <!-- Gold butterfly -->
          <a-entity position="-0.25 0 0">
            <a-triangle color="#FFD700" scale="0.2 0.2 0.2" rotation="0 0 -30"></a-triangle>
            <a-circle color="#FFA500" radius="0.06" position="0 0.05 0.01"></a-circle>
          </a-entity>
          <!-- Purple butterfly -->
          <a-entity position="0 0.25 0">
            <a-triangle color="#9B59B6" scale="0.2 0.2 0.2"></a-triangle>
            <a-circle color="#DDA0DD" radius="0.06" position="0 0.05 0.01"></a-circle>
          </a-entity>
          <!-- Center sparkle -->
          <a-octahedron color="#FFD700" radius="0.08" 
            animation="property: scale; to: 1.3 1.3 1.3; dur: 1000; loop: true; dir: alternate"></a-octahedron>
        </a-entity>

        <!-- Open Treasure Chest -->
        <a-entity id="box3" class="clickable" position="0 0.3 0" scale="0.2 0.2 0.2">
          <a-box color="#8B4513" depth="1" height="0.7" width="1"></a-box>
          <!-- Lid fully open -->
          <a-box color="#DAA520" depth="1.05" height="0.1" width="1.05" position="0 0.6 0.3" rotation="-90 0 0"></a-box>
          
          <!-- Magical items floating out -->
          <a-entity id="treasure-items" visible="false">
            <a-sphere color="#FF1493" radius="0.15" position="0 0.8 0"
              animation="property: position; to: 0 1.2 0; dur: 2000; loop: true; dir: alternate"></a-sphere>
            <a-octahedron color="#FFD700" radius="0.12" position="0.3 0.7 0"
              animation="property: position; to: 0.3 1.1 0; dur: 1800; loop: true; dir: alternate"
              animation__rotate="property: rotation; to: 360 360 0; dur: 3000; loop: true"></a-octahedron>
            <a-torus color="#9B59B6" radius="0.1" radius-tubular="0.03" position="-0.3 0.75 0"
              animation="property: position; to: -0.3 1.15 0; dur: 2200; loop: true; dir: alternate"></a-torus>
          </a-entity>
        </a-entity>

        <!-- Victory Sparkles -->
        <a-entity id="sparkles" position="0 1.5 0" visible="false">
          <a-entity animation="property: rotation; to: 0 360 0; dur: 3000; loop: true">
            <a-sphere color="#FFD700" radius="0.05" position="0.3 0 0"></a-sphere>
            <a-sphere color="#FF1493" radius="0.05" position="-0.3 0 0"></a-sphere>
            <a-sphere color="#9B59B6" radius="0.05" position="0 0 0.3"></a-sphere>
            <a-sphere color="#87CEEB" radius="0.05" position="0 0 -0.3"></a-sphere>
          </a-entity>
        </a-entity>

        <!-- Final Poem -->
        <a-entity id="final-poem" visible="false" position="0 0 0">
          <a-plane color="#F8F0FF" width="2.5" height="1.5" opacity="0.95"
            animation="property: scale; from: 0 0 0; to: 1 1 1; dur: 1000; easing: easeOutElastic"></a-plane>
          <a-text 
            value="ðŸŒ¸ VICTORY! ðŸŒ¸\n\nThree butterflies, three flowers bright,\nTogether they restore the light.\nThe garden's magic now restored,\nBy seekers brave, the quest adored.\n\nâœ¨ The Secret Garden Thanks You! âœ¨" 
            color="#2C3E50"
            align="center"
            width="2.3"
            position="0 0 0.01"
            wrap-count="35"
            line-height="50"
          ></a-text>
        </a-entity>

        <!-- Achievement Badge -->
        <a-entity id="achievement" visible="false" position="0 -0.8 0">
          <a-ring color="#FFD700" radius-inner="0.2" radius-outer="0.25"
            animation="property: rotation; to: 0 0 360; dur: 2000; loop: true"></a-ring>
          <a-text value="MASTER\nGARDENER" color="#FFD700" align="center" width="1" position="0 0 0.01"></a-text>
        </a-entity>

        <a-text 
          value="3/3 COMPLETE!" 
          color="#27AE60"
          align="center"
          width="1.5"
          position="0 1.8 0"
          scale="0.5 0.5 0.5"
          animation="property: scale; to: 0.6 0.6 0.6; dur: 500; loop: true; dir: alternate"
        ></a-text>

      </a-entity>
    </a-nft>

    <a-entity camera look-controls-enabled="false"></a-entity>
  </a-scene>

  <!-- JavaScript for Interactivity -->
  <script>
    // Game state
    let gameState = {
      flower1Found: false,
      flower2Found: false,
      flower3Found: false,
      butterfly1Clicked: false,
      butterfly2Clicked: false,
      petalsClicked: 0,
      startTime: null
    };

    // Wait for scene to load
    document.addEventListener('DOMContentLoaded', function() {
      setTimeout(() => {
        document.querySelector('.arjs-loader').style.display = 'none';
        document.getElementById('hudOverlay').classList.add('show');
      }, 3000);

      // Setup marker listeners
      setupMarkerListeners();
      setupClickListeners();
    });

    function setupMarkerListeners() {
      // Flower 1
      const marker1 = document.getElementById('flower1-marker');
      if (marker1) {
        marker1.addEventListener('markerFound', () => {
          console.log('Flower 1 found!');
          if (!gameState.startTime) gameState.startTime = Date.now();
          gameState.flower1Found = true;
          updateHUD('Pink flowers found! Click the butterfly!', '1/3');
        });
      }

      // Flower 2
      const marker2 = document.getElementById('flower2-marker');
      if (marker2) {
        marker2.addEventListener('markerFound', () => {
          console.log('Flower 2 found!');
          if (!gameState.flower1Found) {
            showLockedMessage();
            return;
          }
          gameState.flower2Found = true;
          updateHUD('Yellow flowers found! Click the butterfly!', '2/3');
        });
      }

      // Flower 3
      const marker3 = document.getElementById('flower3-marker');
      if (marker3) {
        marker3.addEventListener('markerFound', () => {
          console.log('Flower 3 found!');
          if (!gameState.flower1Found || !gameState.flower2Found) {
            showLockedMessage();
            return;
          }
          gameState.flower3Found = true;
          updateHUD('LOTUS FOUND! The treasure is yours!', '3/3 COMPLETE!');
          celebrateVictory();
        });
      }
    }

    function setupClickListeners() {
      // Butterfly 1 - reveals riddle
      const butterfly1 = document.getElementById('butterfly1');
      if (butterfly1) {
        butterfly1.addEventListener('click', () => {
          if (gameState.flower1Found && !gameState.butterfly1Clicked) {
            gameState.butterfly1Clicked = true;
            document.getElementById('riddle1').setAttribute('visible', 'true');
            document.getElementById('progress1').setAttribute('visible', 'true');
            updateHUD('Riddle revealed! Find the yellow flowers!', '1/3');
          }
        });
      }

      // Box 1 - shakes when clicked
      const box1 = document.getElementById('box1');
      if (box1) {
        box1.addEventListener('click', () => {
          box1.setAttribute('animation', 'property: rotation; to: 5 0 0; dur: 100; dir: alternate; loop: 3');
        });
      }

      // Butterfly 2 - reveals small butterflies
      const butterfly2 = document.getElementById('butterfly2');
      if (butterfly2) {
        butterfly2.addEventListener('click', () => {
          if (gameState.flower2Found && !gameState.butterfly2Clicked) {
            gameState.butterfly2Clicked = true;
            document.getElementById('small-butterflies').setAttribute('visible', 'true');
            document.getElementById('riddle2').setAttribute('visible', 'true');
            document.getElementById('progress2').setAttribute('visible', 'true');
            updateHUD('Butterflies released! Find the lotus!', '2/3');
          }
        });
      }

      // Petals - click to form arrow
      const petal1 = document.getElementById('petal1');
      const petal2 = document.getElementById('petal2');
      if (petal1 && petal2) {
        petal1.addEventListener('click', () => {
          gameState.petalsClicked++;
          petal1.setAttribute('color', '#E91E63');
          if (gameState.petalsClicked >= 2) {
            updateHUD('Petals point to the lotus!', '2/3');
          }
        });
        petal2.addEventListener('click', () => {
          gameState.petalsClicked++;
          petal2.setAttribute('color', '#E91E63');
          if (gameState.petalsClicked >= 2) {
            updateHUD('Petals point to the lotus!', '2/3');
          }
        });
      }

      // Box 2
      const box2 = document.getElementById('box2');
      if (box2) {
        box2.addEventListener('click', () => {
          box2.setAttribute('animation', 'property: rotation; to: 0 10 0; dur: 200; dir: alternate; loop: 2');
        });
      }

      // United butterflies - celebrate
      const unitedButterflies = document.getElementById('united-butterflies');
      if (unitedButterflies) {
        unitedButterflies.addEventListener('click', () => {
          if (gameState.flower3Found) {
            document.getElementById('sparkles').setAttribute('visible', 'true');
          }
        });
      }

      // Box 3 - releases treasure
      const box3 = document.getElementById('box3');
      if (box3) {
        box3.addEventListener('click', () => {
          if (gameState.flower3Found) {
            document.getElementById('treasure-items').setAttribute('visible', 'true');
            document.getElementById('final-poem').setAttribute('visible', 'true');
            document.getElementById('achievement').setAttribute('visible', 'true');
          }
        });
      }
    }

    function celebrateVictory() {
      setTimeout(() => {
        document.getElementById('sparkles').setAttribute('visible', 'true');
        document.getElementById('final-poem').setAttribute('visible', 'true');
        document.getElementById('achievement').setAttribute('visible', 'true');
      }, 1000);

      const endTime = Date.now();
      const duration = Math.floor((endTime - gameState.startTime) / 1000);
      console.log(`Quest completed in ${duration} seconds!`);
    }

    function updateHUD(text, progress) {
      document.getElementById('hudText').textContent = text;
      document.getElementById('hudProgress').textContent = 'Progress: ' + progress;
    }

    function showLockedMessage() {
      const msg = document.getElementById('lockedMessage');
      msg.style.display = 'block';
      setTimeout(() => {
        msg.style.display = 'none';
      }, 2000);
    }
  </script>
</body>
</html>